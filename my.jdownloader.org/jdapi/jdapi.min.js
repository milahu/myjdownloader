define("coreCrypto",[],function(){return CryptoJS.lib.WordArray.firstHalf=function(){return this._firstHalf||(this._firstHalf=new CryptoJS.lib.WordArray.init(this.words.slice(0,this.words.length/2))),this._firstHalf},CryptoJS.lib.WordArray.secondHalf=function(){return this._secondHalf||(this._secondHalf=new CryptoJS.lib.WordArray.init(this.words.slice(this.words.length/2,this.words.length))),this._secondHalf},CryptoJS}),define("coreCryptoUtils",["coreCrypto"],function(a){return{hashPassword:function(b,c,d){return a.SHA256(a.enc.Utf8.parse(b.toLowerCase()+c+d.toLowerCase()))},processPassword:function(a){if(!a.email||!a.pass)throw"processPassword requires set options.email and options.pass";a.loginSecret=this.hashPassword(a.email,a.pass,"server"),a.deviceSecret=this.hashPassword(a.email,a.pass,"device"),delete a.pass},initialiseConnection:function(b,c,d){if(!b.loginSecret&&!b.serverEncryptionToken)throw"either loginSecret or serverEncryptionToken must be set, probably should call processPassword(options) first";if(!b.deviceSecret)throw"deviceSecret not set";if(!c||!d)throw"sessiontoken and regaintoken are required to initialise connection";b.sessiontoken=c,b.regaintoken=d;var e=a.enc.Hex.parse(b.sessiontoken);if(b.loginSecret){var f=b.loginSecret.concat(e);b.serverEncryptionTokenOld=b.serverEncryptionToken,b.serverEncryptionToken=a.SHA256(f),delete b.loginSecret}else{b.serverEncryptionTokenOld=b.serverEncryptionToken;var f=b.serverEncryptionToken.concat(e);b.serverEncryptionToken=a.SHA256(f)}var g=b.deviceSecret.clone(),h=g.concat(e);b.deviceEncryptionTokenOld=b.deviceEncryptionToken,b.deviceEncryptionToken=a.SHA256(h)},encryptJSON:function(b,c,d){if(!b){var e={data:c};return e}var f,g;if(d){var h=32,i=window.crypto||window.msCrypto;if(Uint8Array&&i&&i.getRandomValues)try{f=new Uint8Array(16),g=new Uint8Array(h),i.getRandomValues(f),i.getRandomValues(g);var j=this.ua2hex(f),k=this.ua2hex(g);f=CryptoJS.enc.Hex.parse(j),g=CryptoJS.enc.Hex.parse(k)}catch(a){}f&&g||(f=a.lib.WordArray.random(16),g=a.lib.WordArray.random(h))}else f=b.firstHalf(),g=b.secondHalf();var l=a.AES.encrypt(JSON.stringify(c),g,{mode:a.mode.CBC,iv:f}),e={};if(d){var m=new JSEncrypt;m.setPublicKey(d);var n=CryptoJS.enc.Hex.stringify(f),o=CryptoJS.enc.Hex.stringify(g),p=m.encrypt(n+o);e.rsa=p,e.contentType="application/rsajson; charset=utf-8",e.iv=f,e.key=g,e.data=p+"|"+l.toString()}else e.contentType="application/aesjson; charset=utf-8",e.iv=b.firstHalf(),e.key=b.secondHalf(),e.data=l.toString();return e},ua2hex:function(a){for(var b="",c=0;c<a.length;c++){var d=a[c].toString(16);d.length<2&&(d="0"+d),b+=d}return b},decryptJSON:function(b,c,d){try{var e=null,f=a.AES.decrypt(d,c,{mode:a.mode.CBC,iv:b}).toString(a.enc.Utf8);return f&&"string"==typeof f&&(e=JSON.parse(f)),e}catch(a){return d}},decryptRsaJSON:function(a,b,c){var d=new JSEncrypt;d.setPrivateKey(a+b);var e=d.decrypt(c);try{return this.decryptJSON(e.token.firstHalf(),e.token.secondHalf(),e.data)}catch(a){return c}}}}),define("coreRequest",["coreCrypto","coreCryptoUtils"],function(a,b){var c=function(c){if(c.jdParams)if(void 0!==c.serverEncryptionToken&&(c=d(c,c.serverEncryptionToken.firstHalf(),c.serverEncryptionToken.secondHalf())),"GET"===c.type)var e=c.jdAction+"?sessiontoken="+c.sessiontoken+"&rid="+c.rid+"&"+$.param(c.jdParams);else if(c.serverEncryptionToken){c.contentType="application/json; charset=utf-8";var e,f;if("requestterminationemail"===c.jdAction)e="/my/"+c.jdAction+"?sessiontoken="+c.sessiontoken+"&"+$.param(c.jdParams)+"&rid="+c.rid;else{e=c.jdAction+"?sessiontoken="+c.sessiontoken+"&rid="+c.rid,f={apiVer:1,params:[],url:e,rid:c.rid},"{}"!==JSON.stringify(c.jdParams)&&(f.params=[c.jdParams]);var g=b.encryptJSON(c.serverEncryptionToken,f);g.contentType="application/json; charset=UTF-8",c.data=g.data,c.contentType=g.contentType,c=d(c,g.iv,g.key),e+="&signature="+a.HmacSHA256(a.enc.Utf8.parse(e),c.serverEncryptionToken).toString(c.TRANSFER_ENCODING)}c.url=c.API_ROOT+e}else logger.error("[MYJD] [JSAPI] [REQUEST] [FAILED] Server encryption token missing. Action: "+JSON.stringify(c?c.jdAction:"NO_ACTION"));else if(c.deviceEncryptionToken){var g=b.encryptJSON(c.deviceEncryptionToken,c.jdData,c.rsaPublicKey);c.contentType=g.contentType,c.data=g.data,c=d(c,g.iv,g.key),c.url=c.API_ROOT+"/t_"+c.sessiontoken+"_"+c.deviceId+c.jdAction}else logger.error("[MYJD] [JSAPI] [REQUEST] [FAILED] "+JSON.stringify(c?c.type:"NO_OPTIONS")+" Error: Device encryption token missing!")},d=function(a,c,d){return a.converters={"* aesjson-server":b.decryptJSON.bind(this,c,d),"* aesjson":b.decryptJSON.bind(this,c,d)},a},e=function(a){c(a),this.options=a};return $.extend(e.prototype,{send:function(){var a,b=$.Deferred(),c=this.options;c.beforeSend=function(){a=Date.now()};var d=$.ajax(this.options);return d.done(function(d){logger.log("[MYJD] [JSAPI] [REQUEST] "+JSON.stringify(c?c.type:"NO_TYPE")+" "+JSON.stringify(c?c.url:"NO_URL")+"\nOPTIONS:\n"+JSON.stringify(c||"NO_OPTIONS")+"\n\nRESPONSE:\n"+JSON.stringify(d)),d.requestDuration=Date.now()-a,b.resolve(d)}),d.fail(function(d){d.requestDuration=Date.now()-a;try{void 0!==d.responseText?b.reject(JSON.parse(d.responseText)):void 0!==d.statusText?"error"===d.statusText?b.reject({type:"CONNECTION_REFUSED"}):"timeout"===d.statusText?b.reject({type:"TIMEOUT"}):b.reject({type:"UNKNOWN_ERROR"}):b.reject({type:"UNKNOWN_ERROR"})}catch(a){b.reject({type:"UNKNOWN_ERROR"})}logger.error("[MYJD] [JSAPI] [REQUEST] [FAILED] "+JSON.stringify(c?c.type:"NO_TYPE")+" "+JSON.stringify(c?c.url:"NO_URL")+"\nOPTIONS:\n"+JSON.stringify(c||"NO_OPTIONS")+"\n\nRESPONSE:\n"+JSON.stringify(d))}),b}}),e}),define("coreRequestHandler",["coreCrypto","coreCryptoUtils"],function(a,b){var c="jdapi/src/core/coreRequestHandler.js",d=function(a,b,c,d){this.appKey=a,this.transferEncoding=b,this.LOCAL_STORAGE_KEY=c,this.apiRoot=d};return $.extend(d.prototype,{connect:function(c){var d=$.Deferred();if(c&&c.email&&c.pass){b.processPassword(c);var e,f={};f.email=c.email,e="/my/connect",f.appkey=this.appKey,f.rid=0;var g=e+"?"+$.param(f);g+="&signature="+a.HmacSHA256(a.enc.Utf8.parse(g),c.loginSecret).toString(this.transferEncoding);var h=$.ajax({url:this.apiRoot+g,type:"POST",async:!0,dataType:"aesjson-server",converters:{"* aesjson-server":b.decryptJSON.bind(this,c.loginSecret.firstHalf(),c.loginSecret.secondHalf())}});h.fail(d.reject),d.fail(h.abort),h.done(function(a){if(a.rid!==f.rid)return d.reject(void 0,"replay attack");b.initialiseConnection(c,a.sessiontoken,a.regaintoken),dataStore.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(c)).then(function(){d.resolve(c)})}.bind(this))}else{var i=this.LOCAL_STORAGE_KEY;dataStore.getItem(i).then(function(b){var e;try{e=JSON.parse(b[i]),e?(c=$.extend({},e),e.serverEncryptionToken&&(c.serverEncryptionToken=a.lib.WordArray.random(e.serverEncryptionToken.sigBytes),c.serverEncryptionToken.words=e.serverEncryptionToken.words),e.deviceEncryptionToken&&(c.deviceEncryptionToken=a.lib.WordArray.random(e.deviceEncryptionToken.sigBytes),c.deviceEncryptionToken.words=e.deviceEncryptionToken.words),e.deviceSecret&&(c.deviceSecret=a.lib.WordArray.random(e.deviceSecret.sigBytes),c.deviceSecret.words=e.deviceSecret.words),d.resolve(c)):d.reject()}catch(a){d.reject()}})}return d},reconnect:function(d,e){var g,h=$.Deferred(),i=this;return dataStore.getItem(c).then(function(j){try{g=JSON.parse(j[c])}catch(a){}g&&(new Date).getTime()-g.time<5e3?window.addEventListener("storage",function(a){a.key===this.LOCAL_STORAGE_KEY&&(f.newValue?h.resolve():h.reject())},!1):dataStore.setItem(c,JSON.stringify({time:(new Date).getTime()})).then(function(){var f,g={};f="/my/reconnect",g.appkey=i.appKey,g.sessiontoken=d.sessiontoken,g.regainToken=d.regaintoken,g.rid=e;var j=f+"?"+$.param(g);j+="&signature="+a.HmacSHA256(a.enc.Utf8.parse(j),d.serverEncryptionToken).toString(this.transferEncoding);var k=$.ajax({url:d.API_ROOT+j,type:"POST",async:!0,dataType:"aesjson-server",converters:{"* aesjson-server":b.decryptJSON.bind(this,d.serverEncryptionToken.firstHalf(),d.serverEncryptionToken.secondHalf())}});k.fail(h.reject.bind(h)),h.fail(k.abort.bind(k)),k.done(function(a){b.initialiseConnection(d,a.sessiontoken,a.regaintoken),dataStore.removeItem(c),dataStore.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(d)).then(h.resolve)}.bind(i))})}),h},disconnect:function(c){var d={rid:c.rid,sessiontoken:c.sessiontoken},e="/my/disconnect?"+$.param(d);return e+="&signature="+a.HmacSHA256(a.enc.Utf8.parse(e),c.serverEncryptionToken).toString(this.transferEncoding),$.ajax({url:this.apiRoot+e,async:!0,type:"POST",dataType:"aesjson-server",converters:{"* aesjson-server":b.decryptJSON.bind(this,c.serverEncryptionToken.firstHalf(),c.serverEncryptionToken.secondHalf())}}).done(function(a){if(a.rid!==c.rid)return this.connection.reject(void 0,"replay attack")}.bind(this))}}),d}),define("coreCore",["coreCrypto","coreCryptoUtils","coreRequest","coreRequestHandler"],function(a,b,c,d){"use strict";var e,f=a.enc.Hex;if(!(window&&window.location&&window.location.protocol))throw new Error("MyJDownloader JS API: Failed to initialize API Root");if("https:"===window.location.protocol||"http:"===window.location.protocol)e=window.location.protocol+"//api.jdownloader.org";else{if("chrome-extension:"!==window.location.protocol&&"moz-extension:"!==window.location.protocol)throw new Error("MyJDownloader JS API: Unknown host protocol "+window.location.protocol);e="https://api.jdownloader.org"}var g="jdapi/src/core/core.js",h=0,i=1,j=3,k=function(){var a=i,b=new Array;return{setAPIState:function(c){a=c,b.forEach(function(b){try{b(a)}catch(a){}})},getAPIState:function(){return a},addAPIStateChangeListener:function(a){if(!a||"function"!=typeof a)throw new TypeError("APIStateChangeListener must be of type function");-1===b.indexOf(a)&&b.push(a)}}}(),l="myjd_webinterface_1_0_1",m=new Array,n=new d(l,f,g,e),o=0,p=function(){var a=(new Date).getTime();return o===a&&a++,o=a,a},q=function(a,b,c){c&&(l=c),k.setAPIState(i),a=a||{},this.options=a,this.TRANSFER_ENCODING=f,b&&$.isFunction(b.promise)?this.connect(this.options).then(function(){setTimeout(function(){b.resolve()},0)},function(){setTimeout(function(){b.reject()},0)}):b&&$.isFunction(b)?this.connect(this.options).done(function(){setTimeout(function(){b()},0)}):this.connect(this.options),window.addEventListener("storage",function(a){a.key===g&&(a.newValue?this.connect():this.disconnect())}.bind(this),!1)};return $.extend(q.prototype,{requestCount:0,connect:function(a){k.setAPIState(i);var b=$.Deferred(),c=n.connect(a);return c.done(function(a){a.API_ROOT=e,this.options=a,k.setAPIState(h),this._handleEnqueuedRequestsAndSetConnected(),b.resolve(a)}.bind(this)),c.fail(function(a){k.setAPIState(j),b.reject(a)}.bind(this)),b},getRID:p,reconnect:function(){var a=$.Deferred();if(k.getAPIState()==h||k.getAPIState()==i){k.setAPIState(2);var b=n.reconnect(this.options,p());b.done(function(){this._handleEnqueuedRequestsAndSetConnected()}.bind(this)),b.fail(function(){this.disconnect()}.bind(this)),b.then(a.resolve,a.reject)}else a.resolve();return a},disconnect:function(){if(k.getAPIState()===j){var a=$.Deferred();return a.resolve(),a}var b=n.disconnect({serverEncryptionToken:this.options.serverEncryptionToken,sessiontoken:this.options.sessiontoken,rid:p()});return b.always(function(){this.options={},dataStore.removeItem(g),k.setAPIState(j)}.bind(this)),b},serverCall:function(a,b,c,d){b=b||{};var g={jdAction:a,jdParams:b,urlParams:c,type:d||"POST",dataType:"aesjson-server",serverEncryptionToken:this.options.serverEncryptionToken,TRANSFER_ENCODING:f,API_ROOT:e,sessiontoken:this.options.sessiontoken,rid:p()};return this._call(g)},deviceCall:function(a,b,c,d,g){c=c||[];var h=p(),i={jdAction:b,jdData:{url:b,params:c,apiVer:1,rid:h},deviceId:a,type:"POST",dataType:"aesjson-server",deviceEncryptionToken:this.options.deviceEncryptionToken,TRANSFER_ENCODING:f,API_ROOT:e,sessiontoken:this.options.sessiontoken,rid:h};return g&&(i.timeout=g),this._call(i)},localDeviceCall:function(a,b,c,d,e,g){d=d||[];var h=p(),i={jdAction:c,jdData:{url:c,params:d,apiVer:1,rid:h},deviceId:b,type:"POST",dataType:"aesjson-server",deviceEncryptionToken:this.options.deviceEncryptionToken,TRANSFER_ENCODING:f,API_ROOT:a,sessiontoken:this.options.sessiontoken,rid:h};return g&&(i.timeout=g),this._call(i)},getSessionToken:function(){return this.options.sessiontoken},getSessionInfo:function(){return this.options},addAPIStateChangeListener:function(a){k.addAPIStateChangeListener(a)},getAPIState:function(){return k.getAPIState()},getAPIStatePlain:function(){switch(k.getAPIState()){case 0:return"CONNECTED_STATE";case 1:return"PENDING_STATE";case 2:return"RECONNECT_STATE";case 3:return"DISCONNECTED_STATE";default:return"INVALID"}},getCurrentUser:function(){return{loggedIn:3!==this.getAPIState(),name:this.options.email}},API_ROOT:e,APP_KEY:l,_rebuildRequestOptions:function(a){return a.deviceEncryptionToken&&(a.deviceEncryptionToken=this.options.deviceEncryptionToken,a.deviceEncryptionTokenOld=this.options.deviceEncryptionTokenOld),a.serverEncryptionToken&&(a.serverEncryptionToken=this.options.serverEncryptionToken),a.sessiontoken=this.options.sessiontoken,a.rid=p(),a},_handleEnqueuedRequestsAndSetConnected:function(){for(k.setAPIState(h);m.length>0;){var a=m.shift(),b=this._rebuildRequestOptions(a.options);setTimeout(function(){var c=this._call(b,1);c.done(a.deferred.resolve),c.fail(a.deferred.reject)}.bind(this),10)}},_call:function(a,b){b=b||0;var d=$.Deferred();if(k.getAPIState()===h){var e=new c(a).send();e.done(d.resolve),e.fail(function(c){c.type&&"TOKEN_INVALID"===c.type&&0===b?(m.push({deferred:d,options:a}),this.reconnect()):c.type&&"AUTH_FAILED"===c.type?(d.reject(c),this.disconnect()):d.reject(c)}.bind(this))}else m.push({deferred:d,options:a});return d}}),q}),define("device",[],function(){var a=function(a,b){this.jdAPICore=a,this.state="OFFLINE",this.deviceId=b.id,this.rsaPublicKey=b.rsaPublicKey,this.deviceName=b.name};return $.extend(a.prototype,{call:function(a,b,c){return this.localURL?(c&&c(!0),this.jdAPICore.localDeviceCall(this.localURL,this.deviceId,a,b,this.rsaPublicKey)):(c&&c(!1),this.jdAPICore.deviceCall(this.deviceId,a,b,this.rsaPublicKey))},setLocalURL:function(a){this.localURL=a},setPublicKey:function(a){this.publicKey=a},getURL:function(){return this.localURL?this.localURL:this.jdAPICore.API_ROOT},isInLocalMode:function(){return!!this.localURL}}),a}),define("serverServer",["coreCrypto","coreCryptoUtils"],function(a,b){var c=function(a){this.jdapiCore=a};return $.extend(c.prototype,{listDevices:function(){return this.jdapiCore.serverCall("/my/listdevices")},getCaptcha:function(){return $.ajax({url:this.jdapiCore.API_ROOT+"/captcha/getCaptcha",type:"post",dataType:"json"})},registerUser:function(a){a.referrer="webui";var b=this.jdapiCore.API_ROOT+"/my/requestregistrationemail?email="+encodeURIComponent(a.email)+"&captchaResponse="+encodeURIComponent(a.captchaResponse)+"&captchaChallenge="+encodeURIComponent(a.captchaChallenge)+"&referer="+encodeURIComponent(a.referrer);return $.ajax({url:b,type:"POST",dataType:"text"})},confirmEmail:function(c,d,e){if(!e)throw"No credentials given";var f="/my/finishregistration",g=b.hashPassword(c,e,"server"),h=a.enc.Hex.parse(d),i=h.firstHalf(),j=h.secondHalf(),k=a.AES.encrypt(g,j,{mode:a.mode.CBC,iv:i}),l=a.enc.Hex.stringify(k.ciphertext),m=f+"?email="+encodeURIComponent(c)+"&loginSecret="+encodeURIComponent(l);return m+="&signature="+encodeURIComponent(a.HmacSHA256(a.enc.Utf8.parse(m),h).toString(this.jdapiCore.TRANSFER_ENCODING)),$.ajax({url:this.jdapiCore.API_ROOT+m,type:"POST",dataType:"text"})},requestPasswordChangeEmail:function(a,b,c){var d={},e="/my/requestpasswordresetemail";d.email=a,d.captchaResponse=c,d.captchaChallenge=b;var f=e+"?"+$.param(d);return $.ajax({url:this.jdapiCore.API_ROOT+f,type:"POST",dataType:"text"})},requestTerminationEmail:function(a,b){return this.jdapiCore.serverCall("/my/requestterminationemail",{captchaResponse:b,captchaChallenge:a})},finishTermination:function(c,d,e,f,g){var h={email:c,pass:d};b.processPassword(h);var i="/my/finishtermination",j=a.enc.Hex.parse(e),k=j.firstHalf(),l=j.secondHalf(),m=a.AES.encrypt(h.loginSecret,l,{mode:a.mode.CBC,iv:k}),n=a.enc.Hex.stringify(m.ciphertext),o=i+"?email="+encodeURIComponent(c)+"&loginSecret="+encodeURIComponent(n)+"&captchaResponse="+encodeURIComponent(g)+"&captchaChallenge="+encodeURIComponent(f);return o+="&signature="+encodeURIComponent(a.HmacSHA256(a.enc.Utf8.parse(o),j).toString(this.jdapiCore.transferEncoding)),$.ajax({url:this.jdapiCore.API_ROOT+o,type:"POST",dataType:"text"})},changePassword:function(c,d,e){var f="/my/finishpasswordreset",g=b.hashPassword(c,d,"server"),h=a.enc.Hex.parse(e),i=h.firstHalf(),e=h.secondHalf(),j=a.AES.encrypt(g,e,{mode:a.mode.CBC,iv:i}),k=a.enc.Hex.stringify(j.ciphertext),l=f+"?email="+encodeURIComponent(c)+"&loginSecret="+encodeURIComponent(k);return l+="&signature="+encodeURIComponent(a.HmacSHA256(a.enc.Utf8.parse(l),h).toString(this.jdapiCore.TRANSFER_ENCODING)),$.ajax({url:this.jdapiCore.API_ROOT+l,type:"POST",dataType:"text"})},feedback:function(a){return this.jdapiCore.serverCall("/my/feedback",a)},subscribePushNotifications:function(a,b,c){return this.jdapiCore.serverCall("/notify/register",c,{receiverid:a,deviceid:b},"POST")},unsubscribePushNotifications:function(a,b,c){}}),c}),define("serviceService",["coreCryptoUtils","coreCrypto"],function(a,b){var c=function(a){this.jdapiCore=a};return $.extend(c.prototype,{serviceAccessTokens:{},requestAccessToken:function(a){if(this.serviceAccessTokens[a]){var b=$.Deferred();return b.resolve(this.serviceAccessTokens[a]),b}this.serviceAccessTokens[a]={};var c=this.serviceAccessTokens[a];if(c.requestOnTheWay){var d=$.Deferred();return c.deferredQueue=c.deferredQueue||new Array,c.deferredQueue.push(d),d}c.requestOnTheWay=!0;var e={},f="";f="/my/requestaccesstoken",e.service=a;var g=this.jdapiCore.serverCall(f,e);return g.done(function(a){$.extend(c,a)}),g},send:function(a,c,d,e){var f=$.Deferred(),g=this;return this.requestAccessToken(a).done(function(h){var i=d+"?"+e+"&rid=12&accesstoken="+h.accessToken;i=encodeURI(i),i+="&signature="+b.HmacSHA256(b.enc.Utf8.parse(i),b.enc.Hex.parse(h.accessSecret)).toString(b.enc.Hex),$.ajax({url:c+i,type:"GET"}).done(function(b){g.serviceAccessTokens[a]&&g.serviceAccessTokens[a].used++,f.resolve(b)}).fail(function(b){g.serviceAccessTokens[a]&&g.serviceAccessTokens[a].count>0?(delete g.serviceAccessTokens[a],g.sendServiceRequest(a,c,d,e).then(f.resolve,f.reject)):(delete g.serviceAccessTokens[a],f.reject(b))})}).fail(function(a){f.reject(a)}),f}}),c}),define("deviceController",["device"],function(a){var b=5e3,c=5e3,d=function(a){this.index=0,this.items=a||[]};$.extend(d.prototype,{first:function(){return this.reset(),this.next()},next:function(){return this.items[this.index++]},hasNext:function(){return this.index<this.items.length},reset:function(){this.index=0},each:function(a){for(var b=this.first();this.hasNext();b=this.next())a(b)}});var e=function(a,b){this.jdAPIServer=a,this.jdAPICore=b,this.devices={}};return $.extend(e.prototype,{refreshAllDeviceAPIs:function(){var b=$.Deferred(),c=$.Deferred(),d=this.jdAPIServer.listDevices(),e=this;return d.done(function(d){var f=Object.create(null),g=[];$.each(d.list,function(b,c){f[c.id]=new a(e.jdAPICore,c),g.push(c)}),b.resolve(g),e.devices=f,e._checkForLocalMode(d.list).done(c.resolve).fail(c.reject)}),d.fail(function(a){c.reject(a),b.reject(a)}),{deviceList:b,deviceListLocalMode:c}},_checkForLocalMode:function(c){if(void 0!==c&&void 0!==c.length&&0!=c.length){var d=this,e=$.Deferred(),f=[];return $.each(c,function(c,e){d.devices[e.id]=new a(d.jdAPICore,e);var g=$.Deferred();d.jdAPICore.deviceCall(e.id,"/device/getDirectConnectionInfos",[],void 0,b).always(function(a){if(void 0!==a&&void 0!==a.data&&void 0!==a.data.infos&&null!==a.data.infos&&0!==a.data.infos.length){var b=d._pingForAvailability(a.data.infos,e);$.when.apply(this,b).done(function(){g.resolve(e)}).fail(g.reject)}}),f.push(g)}),$.when.apply(this,f).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e}var g=$.Deferred();return g.resolve(c),g},_pingForAvailability:function(a,b){if(void 0!==a&&void 0!==a.length&&0!==a.length){var d,e,f=this,g=[];return $.each(a,function(a,h){var i=$.Deferred();g.push(i);var j;if(void 0===window.location.protocol||"https:"!==window.location.protocol&&"http:"!==window.location.protocol||"https:"===window.location.protocol)if(null!=h.ip.match(/^(\d+\.\d+\.\d+\.\d+)$/))j="https://"+h.ip.replace(new RegExp("\\.","g"),"-")+".mydns.jdownloader.org:"+h.port;else if(null!=h.ip.match(/^(\[[a-f0-9A-F:]+\])$/)){var k=h.ip.replace(/[\[\]]/g,"");k=k.replace(/^:|:$/g,"");for(var l=k.split(":"),m=0;m<l.length;m++){var n=l[m];if(""!=n)l[m]=("0000"+n).substr(-4);else{n=[];for(var o=l.length;o<=8;o++)n.push("0000");l[m]=n.join(":")}}j="https://"+l.join("")+".mydns.jdownloader.org:"+h.port}else j="https://"+h.ip+":"+h.port;else window.location.protocol&&"http:"===window.location.protocol&&(j="http://"+h.ip+":"+h.port);var p=f.jdAPICore.localDeviceCall(j,b.id,"/device/ping",[],void 0,c);p.done(function(a){var c=a.requestDuration;(void 0===d||c<d)&&(d=j,e=c,f.devices[b.id].setLocalURL(j)),i.resolve(f.devices[b.id])}),p.fail(function(a){i.resolve(f.devices[b.id])})}),g}var h=$.Deferred();return h.resolve(),h},_iterateAndCheckForSessionPublicKey:function(b,c){var d=b.next();if(!d)return void c();this.devices[d.id]=this.devices[d.id]||new a(this.jdAPICore,d);var e=this;this.jdAPICore.deviceCall(d.id,"/device/getSessionPublicKey",[],void 0).done(function(a){a&&a.data?e.devices[d.id].rsaPublicKey="-----BEGIN RSA PRIVATE KEY-----"+a.data+"-----END RSA PRIVATE KEY-----":e._iterateAndCheckForSessionPublicKey(b,c)}).fail(function(){e._iterateAndCheckForSessionPublicKey(b,c)})},getDeviceAPIForId:function(a){var b=$.Deferred(),c=this,d=$.Deferred();return c.devices[a]?d.resolve():d=c.refreshAllDeviceAPIs().deviceList,d.always(function(){b.resolve({call:function(b,d){var e=$.Deferred(),f=c.devices[a];return f?f.call(b,d).then(e.resolve,e.reject,e.progress):e.reject({responseText:{type:"DEVICE_NOT_EXISTING"}}),e},getURL:function(){var b=c.devices[a];if(!b)throw"Device with id "+a+" not found";return b.getURL()},getTokenRoot:function(){var b=c.devices[a];if(!b)throw"Device with id "+a+" not found";return b.getURL()+"/t_"+c.jdAPICore.getSessionToken()+"_"+a},isInLocalMode:function(){return c.devices[a].isInLocalMode()},deviceId:a})}),b}}),e});var dataStore;if("undefined"!=typeof chrome&&chrome&&chrome.storage&&chrome.storage.local){var dataStore=Object.create(null);dataStore.setItem=function(a,b){var c=$.Deferred(),d=Object.create(null);return d[a]=b,chrome.storage.local.set(d,c.resolve),c},dataStore.getItem=function(a){var b=$.Deferred();return chrome.storage.local.get(a,function(c){if(c){var d=Object.create(null);d[a]=c[a],b.resolve(d)}else b.reject()}),b},dataStore.removeItem=function(a){var b=$.Deferred();return chrome.storage.local.remove(a,b.resolve),b},dataStore.clear=function(){var a=$.Deferred();return chrome.storage.local.clear(a.resolve),a}}else{var dataStore=Object.create(null);dataStore.setItem=function(a,b){var c=$.Deferred();return c.resolve(window.localStorage.setItem(a,b)),c},dataStore.getItem=function(a){var b=$.Deferred(),c=Object.create(null);return c[a]=window.localStorage.getItem(a),b.resolve(c),b},dataStore.removeItem=function(a){var b=$.Deferred();return b.resolve(window.localStorage.removeItem(a)),b},dataStore.clearStorage=function(){var a=$.Deferred();return a.resolve(window.localStorage.clear()),a}}var LOGGING_ENABLED=!1,logger={log:function(a){LOGGING_ENABLED&&console.log(a)},warn:function(a){LOGGING_ENABLED&&console.warn(a)},error:function(a){LOGGING_ENABLED&&console.error(a)}};define("config/config",[],function(){return{TRANSFER_ENCODING:CryptoJS.enc.Hex,API_ROOT:"//api.jdownloader.org",LOCAL_STORAGE_KEY:"api.transport.options",APP_KEY:"myjd_webinterface_1_0_1"}}),define("jdapi",["coreCore","device","serverServer","serviceService","deviceController"],function(a,b,c,d,e){var f=function(b,f,g){this.jdAPICore=new a(b,f,g),this.apiServer=new c(this.jdAPICore),this.apiService=new d(this.jdAPICore),this.apiDeviceController=new e(this.apiServer,this.jdAPICore)};return $.extend(f.prototype,{getCaptcha:function(){return this.apiServer.getCaptcha()},connect:function(a){return this.jdAPICore.connect(a)},registerUser:function(a){return this.apiServer.registerUser(a)},reconnect:function(){return this.jdAPICore.reconnect()},disconnect:function(){return this.jdAPICore.disconnect()},confirmEmail:function(a,b,c){return this.apiServer.confirmEmail(a,b,c)},requestConfirmEmail:function(a){return this.apiServer.requestConfirmEmail(a)},requestPasswordChangeEmail:function(a,b,c){return this.apiServer.requestPasswordChangeEmail(a,b,c)},requestTerminationEmail:function(a,b){return this.apiServer.requestTerminationEmail(a,b)},finishTermination:function(a,b,c,d,e){return this.apiServer.finishTermination(a,b,c,d,e)},changePassword:function(a,b,c){return this.apiServer.changePassword(a,b,c)},sendServiceRequest:function(a,b,c,d){return this.apiService.send(a,b,c,d)},listDevices:function(a){return void 0!==a&&!0===a?this.apiDeviceController.refreshAllDeviceAPIs().deviceListLocalMode:this.apiDeviceController.refreshAllDeviceAPIs().deviceList},setActiveDevice:function(a){return this.activeDeviceId=a},getActiveDevice:function(){return this.activeDeviceId},getDirectConnectionInfos:function(){return this.transport.getDirectConnectionInfos()},ping:function(){return this.transport.ping()},feedback:function(a){return this.apiServer.feedback(a)},subscribePushNotifications:function(a,b,c){return this.apiServer.subscribePushNotifications(a,b,c)},unsubscribePushNotifications:function(a,b,c){},listen:function(a){return this.send("/events/listen",[a])},subscribe:function(a,b){return this.send("/events/subscribe",[JSON.stringify(a),JSON.stringify(b)])},unsubscribe:function(a){return this.send("/events/unsubscribe",[a])},setSubscriptionId:function(a){return this.send("/events/getSubscriptionId",[a])},getSubscriptionId:function(){return this.send("/events/getSubscriptionId",[])},addSubscription:function(a,b,c){return this.send("/events/addSubscription",[a,b,c])},setSubscription:function(a,b,c){return this.send("/events/setsubscription",[a,JSON.stringify(b),JSON.stringify(c)])},getSubscription:function(a){return this.send("/events/getSubscription",[a])},removeSubscription:function(a,b,c){return this.send("/events/removeSubscription",[a,b,c])},changeSubscriptionTimeouts:function(a,b,c){return this.send("/events/changeSubscriptionTimeouts",[a,b,c])},listPublisher:function(){return this.transport.listPublisher()},stopListen:function(){},send:function(a,b,c){var d=$.Deferred();return this.apiDeviceController.getDeviceAPIForId(this.getActiveDevice()).done(function(e){e.call(a,b,c).then(d.resolve,d.reject,d.progress)}),d},fetchActiveDeviceURL:function(){var a=$.Deferred();return this.apiDeviceController.getDeviceAPIForId(this.getActiveDevice()).done(function(b){var c=b.getURL();a.resolve(c)}),a},fetchActiveDeviceTokenRoot:function(){var a=$.Deferred();return this.apiDeviceController.getDeviceAPIForId(this.getActiveDevice()).done(function(b){var c=b.getTokenRoot();a.resolve(c)}),a},isActiveDeviceInLocalMode:function(){var a=$.Deferred();return this.apiDeviceController.getDeviceAPIForId(this.getActiveDevice()).done(function(b){var c=b.isInLocalMode();a.resolve(c)}),a},getAuth:function(){return this.transport.getAuth()},addAPIStateChangeListener:function(a){this.jdAPICore.addAPIStateChangeListener(a)},getAPIState:function(){return this.jdAPICore.getAPIState()},getAPIStatePlain:function(){return this.jdAPICore.getAPIStatePlain()},getCurrentUser:function(){return this.jdAPICore.getCurrentUser()},getCurrentSessionInfo:function(){var a=this.jdAPICore.getSessionInfo();return{s:a.sessiontoken,r:a.regaintoken,e:a.serverEncryptionToken.toString(CryptoJS.enc.Base64),d:a.deviceSecret.toString(CryptoJS.enc.Base64)}}}),f});